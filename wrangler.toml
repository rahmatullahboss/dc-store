# Wrangler Configuration for DC Store
# https://developers.cloudflare.com/workers/wrangler/configuration/

name = "dc-store"
main = ".open-next/worker.js"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]
account_id = "474078d5f990169d7dadf4e1df83214a"

# Custom Domain Route
routes = [
  { pattern = "dcstore.digitalcare.site", custom_domain = true }
]

# Enable observability/logging
[observability]
enabled = true
head_sampling_rate = 1  # 100% of requests logged

[observability.logs]
enabled = true
invocation_logs = true
head_sampling_rate = 1
persist = true

[observability.traces]
enabled = true
head_sampling_rate = 1
persist = true

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "dc-store-db"
database_id = "3cad0fb5-4cc8-419b-9979-d097ffa0260e"
migrations_dir = "drizzle/migrations"

# Using Cloudinary for image storage instead of R2

# Environment variables (non-sensitive)
[vars]
NEXT_PUBLIC_APP_URL = "https://dcstore.digitalcare.site"
NEXT_PUBLIC_APP_NAME = "DC Store"
NEXT_PUBLIC_BRAND_NAME = "DC Store"
BETTER_AUTH_URL = "https://dcstore.digitalcare.site"

# Secrets (set via: npx wrangler secret put SECRET_NAME)
# - BETTER_AUTH_SECRET
# - GOOGLE_CLIENT_ID
# - GOOGLE_CLIENT_SECRET
# - CLOUDINARY_API_KEY
# - CLOUDINARY_API_SECRET
# - NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME
# - GROQ_API_KEY

# Assets configuration
[assets]
directory = ".open-next/assets"
binding = "ASSETS"

# Build configuration
[build]
command = "npx opennextjs-cloudflare build"
